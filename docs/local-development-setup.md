# Local Development Setup on Ubuntu

This guide describes how to set up the NetCourier AI Chatbot monorepo on a fresh Ubuntu workstation. It covers the core prerequisites, language-specific tooling, service start-up instructions, and how to run the entire stack with Docker Compose.

## 1. Install Prerequisites

Update your package lists and install common build tooling:

```bash
sudo apt update
sudo apt install -y build-essential pkg-config git curl unzip python3 python3-venv python3-pip openjdk-21-jdk maven
```

> **Note:** OpenJDK 21 satisfies the `java.version` property declared by the `chat-api` module so Spring Boot runs without additional configuration.【F:chat-api/pom.xml†L18-L53】

### Node.js 20+

Install Node.js 20 using your preferred method (NodeSource, nvm, or asdf). For example, with NodeSource:

```bash
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs
```

The chat widget relies on Vite and Vitest scripts defined in `package.json`.【F:chat-widget/package.json†L1-L20】

### UV or pip for Python tooling

Python 3.10+ is installed above. Optionally install [uv](https://github.com/astral-sh/uv) for faster dependency resolution, or use `pip`/`venv`.

### Docker (optional)

To run the full stack, install Docker Engine and Docker Compose Plugin following [Docker's official instructions](https://docs.docker.com/engine/install/ubuntu/).

## 2. Clone the Repository

```bash
git clone https://github.com/your-org/chatbot.git
cd chatbot
```

The repository layout is summarised in `README.md`, including the API, embeddings service, widget, and infrastructure directories.【F:README.md†L8-L35】

## 3. Java Chat API Service (`chat-api/`)

1. Navigate to the module and install dependencies (Maven downloads them automatically on the first run):
   ```bash
   cd chat-api
   mvn clean compile
   ```
2. Export optional environment variables:
   * `CHAT_SECURITY_STATIC_TOKEN` – sets a shared bearer token for local testing. Leave unset to use the default OAuth2 resource server configuration.【F:README.md†L56-L79】
   * `SPRING_PROFILES_ACTIVE` – defaults to `default`. Override if you maintain custom Spring profiles.
3. Launch the service:
   ```bash
   mvn spring-boot:run
   ```
4. Access the NDJSON streaming endpoint at `http://localhost:8080/api/chat` and generated OpenAPI docs at `http://localhost:8080/swagger-ui.html`.【F:README.md†L41-L54】

### Ingestion Endpoints (optional)

Use `curl` to upload documents for RAG evaluation:

```bash
curl -X POST "http://localhost:8080/admin/ingest/upload" \
  -H "Authorization: Bearer DEV" \
  -F tenantId=ILG \
  -F title="Delivery SOP" \
  -F roles=CP \
  -F file=@docs/sample.pdf
```

Successful responses return metadata for the ingested chunks.【F:README.md†L56-L92】

## 4. Python Embeddings Service (`embeddings-service/`)

1. Create a virtual environment and activate it:
   ```bash
   cd ../embeddings-service
   python3 -m venv .venv
   source .venv/bin/activate
   ```
2. Install dependencies (use `uv pip install` if you prefer uv):
   ```bash
   pip install -e .[dev]
   ```
3. Start the FastAPI application:
   ```bash
   uvicorn app.main:app --reload
   ```
   The default host and port match the `pyproject.toml` UVicorn settings.【F:embeddings-service/pyproject.toml†L1-L24】
4. Visit `http://localhost:8000/docs` to inspect the autogenerated OpenAPI schema.

Run tests with `pytest` from the activated environment:

```bash
pytest
```

## 5. Web Component Widget (`chat-widget/`)

1. Install Node dependencies:
   ```bash
   cd ../chat-widget
   npm install
   ```
2. Launch the Vite dev server:
   ```bash
   npm run dev
   ```
3. Preview the widget by opening the printed local URL in your browser. Vitest-based tests run via:
   ```bash
   npm test
   ```

Scripts and dependencies are defined in `package.json`.【F:chat-widget/package.json†L1-L20】

## 6. Full Local Stack with Docker Compose

The `infra/docker-compose.yml` file builds the chat API and embeddings service and provisions PostgreSQL, Qdrant, and OpenSearch containers with sensible development defaults.【F:infra/docker-compose.yml†L1-L39】

```bash
cd ../infra
docker compose up --build
```

This binds services to:

* Chat API – `http://localhost:8080`
* Embeddings – `http://localhost:8000`
* PostgreSQL – `localhost:5432` (user/password `chatbot`)
* Qdrant – `http://localhost:6333`
* OpenSearch – `http://localhost:9200`

By default the chat API looks for embeddings on `http://localhost:9000` via the
`chat.embeddings.base-url` property.【F:chat-api/src/main/resources/application.yml†L56-L60】
When running under Docker Compose you must override this so the API reaches the
`embeddings` container. Add the following environment variable to the
`chat-api` service before starting the stack:

```yaml
  chat-api:
    environment:
      CHAT_EMBEDDINGS_BASE_URL: http://embeddings:8000
```

This instructs Spring to call the embeddings backend over the Compose network,
while the port 8000 binding remains available on the host for debugging or
manual calls.【F:infra/docker-compose.yml†L1-L24】

Stop the stack with `CTRL+C` or `docker compose down`.

## 7. Running Tests Across Modules

* Chat API: `cd chat-api && mvn test`
* Embeddings service: `cd embeddings-service && pytest`
* Widget: `cd chat-widget && npm test`

These commands mirror the guidance in the top-level README.【F:README.md†L93-L100】

## 8. Development Tips

* Use separate terminal tabs or tmux panes to run each service simultaneously.
* Keep an eye on service logs; Spring Boot exposes standard Actuator endpoints, and FastAPI/UVicorn prints request logs to the console.
* When iterating on ingestion, ensure Docker containers for Qdrant and OpenSearch are running (either via Compose or managed instances) to persist embeddings and search documents.

You are now ready to iterate on the NetCourier AI Chatbot locally on Ubuntu.
